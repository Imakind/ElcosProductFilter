<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="https://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <title>–î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="p-4">
<div class="container">
    <h2>–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π —Ç–æ–≤–∞—Ä</h2>
    <!-- –ï—Å–ª–∏ filterParams != null -->
    <a th:if="${filterParams != null}"
       th:href="@{/filter/results(
       brandId=${filterParams['brandId']},
       groupId=${filterParams['groupId']},
       subGroupId=${filterParams['subGroupId']},
       param1=${filterParams['param1']},
       param2=${filterParams['param2']},
       param3=${filterParams['param3']},
       param4=${filterParams['param4']},
       param5=${filterParams['param5']}
   )}"
       class="btn btn-secondary mb-3">
        ‚Üê –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ —Ñ–∏–ª—å—Ç—Ä—É
    </a>

    <!-- –ï—Å–ª–∏ filterParams == null -->
    <a th:unless="${filterParams != null}"
       th:href="@{/filter/results}"
       class="btn btn-secondary mb-3">
        ‚Üê –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ —Ñ–∏–ª—å—Ç—Ä—É
    </a>

    <form action="/admin/import-excel" method="post" enctype="multipart/form-data" class="mb-4">
        <label for="excelFile" class="form-label fw-bold">üì• –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–≤–∞—Ä—ã –∏–∑ Excel:</label>
        <div class="input-group">
            <input type="file" class="form-control" id="excelFile" name="file" accept=".xlsx" required>
            <button type="submit" class="btn btn-outline-primary">–ó–∞–≥—Ä—É–∑–∏—Ç—å</button>
        </div>
    </form>


    <form th:action="@{/admin/add-product}" method="post">
    <div class="mb-3">
            <label for="brandId" class="form-label">–ë—Ä–µ–Ω–¥</label>
            <select id="brandId" name="brandId" class="form-select" required>
                <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –±—Ä–µ–Ω–¥</option>
                <th:block th:each="brand : ${brands}">
                    <option th:value="${brand.brandId}" th:text="${brand.brandName}"></option>
                </th:block>
            </select>
        </div>

        <div class="mb-3">
            <label for="groupId" class="form-label">–ì—Ä—É–ø–ø–∞</label>
            <select id="groupId" name="groupId" class="form-select" required>
                <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –≥—Ä—É–ø–ø—É</option>
                <th:block th:each="group : ${groups}">
                    <option th:value="${group.categoryId}" th:text="${group.name}"></option>
                </th:block>
            </select>
        </div>

        <div class="mb-3">
            <label for="subGroupId" class="form-label">–ü–æ–¥–≥—Ä—É–ø–ø–∞</label>
            <select id="subGroupId" name="subGroupId" class="form-select">
                <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–¥–≥—Ä—É–ø–ø—É</option>
            </select>
        </div>

        <div class="mb-3">
            <label for="name" class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞</label>
            <input type="text" class="form-control" id="name" name="name" required>
        </div>

        <div class="mb-3">
            <label for="articleCode" class="form-label">–ê—Ä—Ç–∏–∫—É–ª</label>
            <input type="text" class="form-control" id="articleCode" name="articleCode" required>
        </div>

        <div class="mb-3">
            <label for="param1" class="form-label">–ü–∞—Ä–∞–º–µ—Ç—Ä 1</label>
            <input type="text"
                   id="param1"
                   name="param1"
                   class="form-control"
                   list="param1Options"
                   th:value="${filterParams != null ? filterParams['param1'] : ''}"
            placeholder="–í—ã–±–µ—Ä–∏—Ç–µ –∏–ª–∏ –≤–≤–µ–¥–∏—Ç–µ –Ω–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ">

            <datalist id="param1Options">
                <option th:each="val : ${param1List}" th:value="${val}"></option>
            </datalist>
        </div>



        <div class="mb-3">
            <label for="param2" class="form-label">–ü–∞—Ä–∞–º–µ—Ç—Ä 2</label>
            <input type="text" class="form-control" id="param2" name="param2">
        </div>
        <div class="mb-3">
            <label for="param3" class="form-label">–ü–∞—Ä–∞–º–µ—Ç—Ä 3</label>
            <input type="text" class="form-control" id="param3" name="param3">
        </div>
        <div class="mb-3">
            <label for="param4" class="form-label">–ü–∞—Ä–∞–º–µ—Ç—Ä 4</label>
            <input type="text" class="form-control" id="param4" name="param4">
        </div>
        <div class="mb-3">
            <label for="param5" class="form-label">–ü–∞—Ä–∞–º–µ—Ç—Ä 5</label>
            <input type="text" class="form-control" id="param5" name="param5">
        </div>

        <div class="mb-3">
            <label for="price" class="form-label">–¶–µ–Ω–∞ (Base Price)</label>
            <input type="number" step="any" class="form-control" id="price" name="price" required>
        </div>

        <a href="/" class="btn btn-secondary">–û—Ç–º–µ–Ω–∞</a>
        <button type="submit" class="btn btn-primary">–î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä</button>
        <div th:if="${error}" class="alert alert-danger" th:text="${error}"></div>
    </form>
</div>

<script th:inline="javascript">
    function onBrandChange() {
        let brandId = document.getElementById('brandId').value;

        if (!brandId) {
            clearSelect('groupId');
            clearSelect('subGroupId');
            return;
        }

        fetch('/filter/groups?brandId=' + brandId)
            .then(res => res.json())
            .then(data => {
                updateSelect('groupId', data.map(group => ({ value: group.categoryId, text: group.name })));
                clearSelect('subGroupId'); // –æ–±–Ω—É–ª—è–µ–º –ø–æ–¥–≥—Ä—É–ø–ø—É
            });
    }

    function onGroupChange() {
        let groupId = document.getElementById('groupId').value;

        if (!groupId) {
            clearSelect('subGroupId');
            return;
        }

        fetch('/filter/subgroups?groupId=' + groupId)
            .then(res => res.json())
            .then(data => {
                updateSelect('subGroupId', data.map(sub => ({ value: sub.categoryId, text: sub.name })));
            });
    }

    function updateSelect(selectId, options) {
        let select = document.getElementById(selectId);
        select.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∑–Ω–∞—á–µ–Ω–∏–µ</option>';
        options.forEach(opt => {
            select.innerHTML += `<option value="${opt.value}">${opt.text}</option>`;
        });
        select.disabled = options.length === 0;
    }

    function clearSelect(selectId) {
        let select = document.getElementById(selectId);
        select.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∑–Ω–∞—á–µ–Ω–∏–µ</option>';
        select.disabled = true;
    }

    document.addEventListener('DOMContentLoaded', function () {
        document.getElementById('brandId').addEventListener('change', onBrandChange);
        document.getElementById('groupId').addEventListener('change', onGroupChange);
    });
</script>



</body>
</html>
