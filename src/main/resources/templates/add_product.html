<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Добавить товар</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="p-4">
<div class="container">
    <h2>Добавить новый товар</h2>

    <form th:action="@{/admin/add-product}" method="post">
    <div class="mb-3">
            <label for="brandId" class="form-label">Бренд</label>
            <select id="brandId" name="brandId" class="form-select" required>
                <option value="">Выберите бренд</option>
                <th:block th:each="brand : ${brands}">
                    <option th:value="${brand.brandId}" th:text="${brand.brandName}"></option>
                </th:block>
            </select>
        </div>

        <div class="mb-3">
            <label for="groupId" class="form-label">Группа</label>
            <select id="groupId" name="groupId" class="form-select" required>
                <option value="">Выберите группу</option>
                <th:block th:each="group : ${groups}">
                    <option th:value="${group.categoryId}" th:text="${group.name}"></option>
                </th:block>
            </select>
        </div>

        <div class="mb-3">
            <label for="subGroupId" class="form-label">Подгруппа</label>
            <select id="subGroupId" name="subGroupId" class="form-select">
                <option value="">Выберите подгруппу</option>
            </select>
        </div>

        <div class="mb-3">
            <label for="name" class="form-label">Название товара</label>
            <input type="text" class="form-control" id="name" name="name" required>
        </div>

        <div class="mb-3">
            <label for="articleCode" class="form-label">Артикул</label>
            <input type="text" class="form-control" id="articleCode" name="articleCode" required>
        </div>

        <div class="mb-3">
            <label for="param1" class="form-label">Параметр 1</label>
            <input type="text" class="form-control" id="param1" name="param1">
        </div>
        <div class="mb-3">
            <label for="param2" class="form-label">Параметр 2</label>
            <input type="text" class="form-control" id="param2" name="param2">
        </div>
        <div class="mb-3">
            <label for="param1" class="form-label">Параметр 3</label>
            <input type="text" class="form-control" id="param3" name="param1">
        </div>
        <div class="mb-3">
            <label for="param2" class="form-label">Параметр 4</label>
            <input type="text" class="form-control" id="param4" name="param2">
        </div>
        <div class="mb-3">
            <label for="param1" class="form-label">Параметр 5</label>
            <input type="text" class="form-control" id="param5" name="param1">
        </div>

        <div class="mb-3">
            <label for="price" class="form-label">Цена (Base Price)</label>
            <input type="number" step="any" class="form-control" id="price" name="price" required>
        </div>

        <a href="/" class="btn btn-secondary">Отмена</a>
        <button type="submit" class="btn btn-primary">Добавить товар</button>
        <div th:if="${error}" class="alert alert-danger" th:text="${error}"></div>
    </form>
</div>

<script th:inline="javascript">
    function onBrandChange() {
        let brandId = document.getElementById('brandId').value;

        if (!brandId) {
            clearSelect('groupId');
            clearSelect('subGroupId');
            return;
        }

        fetch('/filter/groups?brandId=' + brandId)
            .then(res => res.json())
            .then(data => {
                updateSelect('groupId', data.map(group => ({ value: group.categoryId, text: group.name })));
                clearSelect('subGroupId'); // обнуляем подгруппу
            });
    }

    function onGroupChange() {
        let groupId = document.getElementById('groupId').value;

        if (!groupId) {
            clearSelect('subGroupId');
            return;
        }

        fetch('/filter/subgroups?groupId=' + groupId)
            .then(res => res.json())
            .then(data => {
                updateSelect('subGroupId', data.map(sub => ({ value: sub.categoryId, text: sub.name })));
            });
    }

    function updateSelect(selectId, options) {
        let select = document.getElementById(selectId);
        select.innerHTML = '<option value="">Выберите значение</option>';
        options.forEach(opt => {
            select.innerHTML += `<option value="${opt.value}">${opt.text}</option>`;
        });
        select.disabled = options.length === 0;
    }

    function clearSelect(selectId) {
        let select = document.getElementById(selectId);
        select.innerHTML = '<option value="">Выберите значение</option>';
        select.disabled = true;
    }

    document.addEventListener('DOMContentLoaded', function () {
        document.getElementById('brandId').addEventListener('change', onBrandChange);
        document.getElementById('groupId').addEventListener('change', onGroupChange);
    });
</script>



</body>
</html>
