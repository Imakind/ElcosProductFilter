<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>–ö–æ–º–º–µ—Ä—á–µ—Å–∫–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="p-4">
<div class="container">
    <h2>–ö–æ–º–º–µ—Ä—á–µ—Å–∫–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ</h2>
    <table class="table table-bordered mt-4">
        <thead>
        <tr>
            <th>–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ</th>
            <th>–ë—Ä–µ–Ω–¥</th>
            <th>–¶–µ–Ω–∞</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="product : ${products}">
            <td th:text="${product.name}">–ù–∞–∑–≤–∞–Ω–∏–µ</td>
            <td th:text="${product.brand.brandName}">–ë—Ä–µ–Ω–¥</td>
            <td>
                <div class="price-format" th:text="${product.price}">0</div>
                <div th:if="${quantities[product.productId] != null and coefficientMap[product.productId] != null}" class="text-danger">
                    –¶–µ–Ω–∞ –ø—Ä–æ–¥–∞–∂–∏:
                    <span class="price-format"
                          th:text="${product.price * coefficientMap[product.productId]}">0</span>
                    ‚Ç∏
                </div>
            </td>
            <td th:text="${quantities[product.productId]}">1</td>
        </tr>
        </tbody>
        <tfoot>
        <tr>
            <td colspan="3" class="text-end fw-bold">–û–±—â–∞—è —Å—É–º–º–∞:</td>
            <td class="price-format" th:text="${totalSum}">0</td>
        </tr>
        </tfoot>

    </table>

    <a href="/proposal/pdf" class="btn btn-outline-secondary">üìÑ –°–∫–∞—á–∞—Ç—å –ö–ü –≤ PDF</a>
    <br>
    <a href="/proposal/excel-kp" class="btn btn-outline-secondary">üì• –°–∫–∞—á–∞—Ç—å –ö–ü –≤ Excel</a>
    <br>
    <div class="d-flex justify-content-between mt-4">
        <a href="/cart" class="btn btn-secondary">‚Üê –í–µ—Ä–Ω—É—Ç—å—Å—è –≤ –∫–æ—Ä–∑–∏–Ω—É</a>
        <a href="/proposal/excel" class="btn btn-success">üì• –°–∫–∞—á–∞—Ç—å —Å–º–µ—Ç—É –≤ Excel</a>
    </div>
    <a href="/" class="btn btn-primary">‚Üê –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ —Ñ–∏–ª—å—Ç—Ä—É</a>

</div>

<div th:replace="~{fragments/history_modal :: proposalHistoryModal}"></div>


<script>
    document.querySelectorAll(".price-format").forEach(el => {
        const num = parseFloat(el.innerText.replace(",", "."));
        if (!isNaN(num)) {
            el.innerText = num.toLocaleString('ru-RU', { minimumFractionDigits: 2 });
        }
    });
</script>

</body>
</html>
