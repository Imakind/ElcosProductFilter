<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="https://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <title>–ö–æ–º–º–µ—Ä—á–µ—Å–∫–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="p-4">
<div class="container">
    <h2 class="mb-4">–ö–æ–º–º–µ—Ä—á–µ—Å–∫–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ</h2>

    <table class="table table-bordered text-center align-middle">
        <thead class="table-light">
        <tr>
            <th>‚Ññ</th>
            <th>–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ</th>
            <th>–ê—Ä—Ç–∏–∫—É–ª</th>
            <th>–ë—Ä–µ–Ω–¥</th>
            <th>–ö–æ–ª-–≤–æ</th>
            <th>–¶–µ–Ω–∞</th>
            <th>–°—É–º–º–∞</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="product, stat : ${products}">
            <td th:text="${stat.index + 1}">1</td>
            <td th:text="${product.name}">–ù–∞–∑–≤–∞–Ω–∏–µ</td>
            <td th:text="${product.articleCode}">–ê—Ä—Ç–∏–∫—É–ª</td>
            <td th:text="${product.brand.brandName}">–ë—Ä–µ–Ω–¥</td>
            <td th:text="${quantities[product.productId]}">1</td>
            <td class="price-format"
                th:text="${finalPrices[product.productId]}">0</td>
            <td class="price-format"
                th:text="${totalSums[product.productId]}">0</td>
        </tr>
        </tbody>
        <tfoot>
        <tr class="fw-bold">
            <td colspan="4" class="text-end">–ò—Ç–æ–≥–æ:</td>
            <td th:text="${totalQuantity}">0</td>
            <td></td>
            <td class="price-format" th:text="${totalSum}">0</td>
        </tr>
        </tfoot>
    </table>


    <a href="/proposal/pdf" class="btn btn-outline-secondary">üìÑ –°–∫–∞—á–∞—Ç—å –ö–ü –≤ PDF</a>
    <a href="/proposal/excel-kp" class="btn btn-outline-secondary ms-2">üì• –°–∫–∞—á–∞—Ç—å –ö–ü –≤ Excel</a>
    <div class="d-flex justify-content-between mt-4">
        <a href="/cart" class="btn btn-secondary">‚Üê –í–µ—Ä–Ω—É—Ç—å—Å—è –≤ –∫–æ—Ä–∑–∏–Ω—É</a>
        <a href="/clear-cart-and-return" class="btn btn-primary">‚Üê –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ —Ñ–∏–ª—å—Ç—Ä—É</a>
    </div>
</div>

<script>
    document.querySelectorAll(".price-format").forEach(el => {
        const num = parseFloat(el.innerText.replace(",", "."));
        if (!isNaN(num)) {
            el.innerText = num.toLocaleString('ru-RU', {
                minimumFractionDigits: 1,
                maximumFractionDigits: 1,
                useGrouping: true
            });
        }
    });
</script>
</body>
</html>
