<div th:fragment="productList">
    <div class="list-group-item d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center"
         style="min-height: 100px;"
         th:each="prod : ${products}"
         th:id="'product-' + ${prod.productId}"
         th:classappend="${quantities != null and quantities[prod.productId] != null} ? ' border border-success rounded shadow-sm bg-light' : ''">

        <!-- –õ–µ–≤–∞—è —á–∞—Å—Ç—å: –∫–Ω–æ–ø–∫–∏ –∏ —Ç–µ–∫—Å—Ç -->
        <div class="d-flex flex-grow-1 flex-column flex-md-row w-100">
            <!-- –ö–Ω–æ–ø–∫–∏ —Å–ª–µ–≤–∞ -->
            <div class="me-3 d-flex flex-row flex-md-column gap-1">
                <button class="btn btn-outline-secondary btn-sm"
                        th:attr="onclick='openEditModal(' + ${prod.productId} + ')'"
                        title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–≤–∞—Ä">‚úè</button>
                <button class="btn btn-outline-danger btn-sm"
                        th:attr="onclick='showDeleteConfirmation(' + ${prod.productId} + ')'"
                        title="–£–¥–∞–ª–∏—Ç—å —Ç–æ–≤–∞—Ä">üóë</button>
            </div>

            <!-- –ù–∞–∑–≤–∞–Ω–∏–µ –∏ –∏–Ω—Ñ–æ –ø–æ —Ü–µ–Ω—Ç—Ä—É -->
            <div class="flex-grow-1">
                <h5 class="mb-1" style="word-break: break-word;">
                    <span th:text="${prod.name}">–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞</span>
                </h5>
                <small th:text="'–ë—Ä–µ–Ω–¥: ' + ${prod.brand.brandName}"></small><br>
                <small class="text-danger" th:if="${prod.price != null}"
                       th:text="'–¶–µ–Ω–∞: ' + ${#strings.replace(#numbers.formatDecimal(prod.price, 1, 'COMMA', 2, 'POINT'), ',', ' ')} + ' ‚Ç∏'"></small>
                <small class="text-danger" th:if="${prod.price == null}" th:text="'–¶–µ–Ω–∞: –ù–µ —É–∫–∞–∑–∞–Ω–∞'"></small>
            </div>
        </div>

        <!-- –ü—Ä–∞–≤–∞—è —á–∞—Å—Ç—å: –∫–æ—Ä–∑–∏–Ω–∞ -->
        <div class="input-group" style="max-width: 160px">
            <button type="button" class="btn btn-outline-secondary btn-sm"
                    th:onclick="'removeFromCart(' + ${prod.productId} + ')'">‚ûñ</button>

            <input type="number" min="0" class="form-control form-control-sm text-center"
                   th:id="'counter-' + ${prod.productId}"
                   th:value="${quantities[prod.productId] != null ? quantities[prod.productId] : 0}"
                   onchange="manualQuantityChange(this)"
                   style="max-width: 60px;">

            <button type="button" class="btn btn-outline-secondary btn-sm"
                    th:onclick="'addToCart(' + ${prod.productId} + ')'">‚ûï</button>
        </div>
    </div>
</div>


<script>
    function attachProductHandlers(item) {
        const editBtn = item.querySelector('button[title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–≤–∞—Ä"]');
        const deleteBtn = item.querySelector('button[title="–£–¥–∞–ª–∏—Ç—å —Ç–æ–≤–∞—Ä"]');

        if (editBtn) {
            const id = editBtn.getAttribute('onclick').match(/\d+/)[0];
            editBtn.onclick = () => openEditModal(parseInt(id));
        }

        if (deleteBtn) {
            const id = deleteBtn.getAttribute('onclick').match(/\d+/)[0];
            deleteBtn.onclick = () => showDeleteConfirmation(parseInt(id));
        }
    }
</script>
